version: '3.8'

services:
  # 1. The Cache/Queue Layer
  redis:
    image: redis:alpine
    container_name: sentinai-redis
    ports:
      - "6379:6379"
    restart: always

  # 2. The AI Backend
  backend:
    build: 
      context: ./apps/backend
    container_name: sentinai-backend
    environment:
      - REDIS_HOST=redis
    ports:
      - "8000:8000"
    depends_on:
      - redis
    restart: on-failure

  # 3. The Frontend (Served by Nginx)
  frontend:
    build: 
      context: ./apps/frontend
    container_name: sentinai-frontend
    ports:
      - "80:80" # We expose port 80 to the internet
    volumes:
      # We inject the config at runtime (easier than copying in build)
      - ./infrastructure/nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
